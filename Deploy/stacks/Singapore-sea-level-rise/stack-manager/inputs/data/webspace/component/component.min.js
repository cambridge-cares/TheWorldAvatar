class DynamicComponent{constructor(e){this.id_container="dynamicInterfaceContainer",this.id_title="dynamicComponentTitle",this.id_content="dynamicContent",console.log("Rendering an additional custom UI component..."),this.container=createDiv({id:this.id_container}),this.container_content=createDiv({id:this.id_content}),this.container_title=createDiv({id:this.id_title}),this.container_title.textContent=e}render(e){this.container.appendChild(this.container_title),this.container.appendChild(this.container_content),e.appendChild(this.container)}}function createErrorMessageElement(e){var t=createDiv();return t.textContent=e,t.style.color="red",t.style.display="none",t}function createDiv(e){return createHTMLElement("div",e)}function createHTMLElement(e,t){e=document.createElement(e);return t&&(t.id&&(e.id=t.id),t.classes)&&e.classList.add(...t.classes),e}function execSparqlQuery(e,i){return new Promise(function(t,n){$.ajax({type:"GET",url:e,dataType:"json",data:{query:i,format:"json"},success:function(e){e.results&&e.results.bindings?t(e.results.bindings):n("Invalid SPARQL result format! "+e)},error:function(e,t){n(e+": "+t)}})})}class SeachEntityComponent extends DynamicComponent{constructor(e,t,n){super(e),this.numerical_placeholder_message="Type a number",this.search_container_id="searchContainer",this.INVALID_INPUT_MESSAGE="Invalid input. Please enter a numerical value.",this.options=n,this.initContainerAttributes(),this.loader=new Loader,this.overlay=new Overlay,this.loader.render(this.container),this.overlay.render(this.container);e=this.container_content;new SelectDropdownComponent("Land Use Type",this.options.stackUrl,n.plotNamespace).render(e);let i=new SearchTextInputComponent("Plot Area [m2]",this.numerical_placeholder_message,this.INVALID_INPUT_MESSAGE),r=(i.render(e),new SearchTextInputComponent("Gross Floor Area [m2]",this.numerical_placeholder_message,this.INVALID_INPUT_MESSAGE));r.render(e);var n=createDiv({classes:["line-item","evenly-space-container"]}),a=createHTMLElement("button",{classes:["control-button"]}),a=(a.textContent="Submit",a.addEventListener("click",()=>this.handleSubmit(t,this.options.layerId,[i,r])),n.appendChild(a),createHTMLElement("button",{classes:["control-button"]}));a.textContent="Clear inputs",a.addEventListener("click",()=>this.handleClear()),n.appendChild(a),e.appendChild(n)}render(e){e.parentNode?.querySelector(this.search_container_id)||(this.container.appendChild(this.container_title),this.container.appendChild(this.container_content),e.parentNode.insertBefore(this.container,e))}initContainerAttributes(){this.container.id=this.search_container_id,this.container.classList.add("controlBlock"),this.container_title.id="controlTitle",this.container_title.classList.add("controlTitle"),this.container_content.removeAttribute("id"),this.container_content.classList.add("controlContents"),this.container_content.classList.add("scrollable-content")}handleSubmit(n,i,e){n.setFilter(i,null);var r=this.retrieveSelectedOptions(this.container_content.firstElementChild);try{var a=this.retrieveMinMaxInput(e[0],!0),s=this.retrieveMinMaxInput(e[1],!0);if("''"!==r||"''"!==a[0]||"''"!==s[0]){this.overlay.show(),this.loader.show();var o={subs:`{"minarea":"${a[0]}", "maxarea":"${a[1]}", 
        "mingfa":"${s[0]}", "maxgfa":"${s[1]}", "landusetype":"${r}"}`,namespace:this.options.plotNamespace};let t=this;$.ajax({url:this.options.stackUrl+"/filter-agent/filter",type:"GET",data:o,success:function(e){e=e.slice(1,-1).split(", ");0<e[0].length&&n.setFilter(i,["in",["get","iri"],["literal",e]]),t.loader.hide(),t.overlay.hide()},error:e=>{console.error("Error:",e)}})}}catch(e){if(e.message!=this.INVALID_INPUT_MESSAGE)throw e}}retrieveSelectedOptions(e){let t=[];e.querySelectorAll('input[type="checkbox"]:checked').forEach(e=>{t.push(e.value)});let n="''";return 0<t.length&&(e=t.map(e=>`'${e}'`),n=e.join(",")),n}retrieveMinMaxInput(e,t){var n=e.getCurrentValues();let i=n[0],r=n[1];if(""===i&&""===r)return["''","''"];""===i?i="0":""===r&&(r="9999999999");n=/^\d+$/.test(i[0])&&/^\d+$/.test(r[1]);return t&&!n&&e.invokeError(),[i,r]}handleClear(){var e=this.container_content.firstElementChild,e=(e.querySelectorAll('input[type="checkbox"]:checked').forEach(e=>{e.checked=!1}),e.nextElementSibling),e=(this.clearTextInputs(e),e.nextElementSibling);this.clearTextInputs(e)}clearTextInputs(e){e.querySelectorAll('input[type="text"]').forEach(e=>{e.value=""})}}class SearchTextInputComponent{constructor(e,t,n=""){this.container=createDiv({classes:["line-padding"]});var i=createDiv(),e=(i.textContent=e,createDiv({classes:["line-item","space-around-container"]})),r=createDiv(),a=(r.innerHTML="Min:",this.min_text_input_element=this.genInputElement(t),createDiv({classes:["line-item","space-around-container"]})),s=createDiv();s.innerHTML="Max:",this.max_text_input_element=this.genInputElement(t),e.appendChild(r),e.appendChild(this.min_text_input_element),a.appendChild(s),a.appendChild(this.max_text_input_element),this.container.appendChild(i),this.container.appendChild(e),this.container.appendChild(a),0<n.length&&(this.error_message_element=createErrorMessageElement(n),this.container.appendChild(this.error_message_element))}getCurrentValues(){return[this.min_text_input_element.value,this.max_text_input_element.value]}invokeError(){throw this.error_message_element.style.display="block",console.log(this.error_message_element.textContent),setTimeout(()=>{this.error_message_element.style.display="none"},5e3),new Error(this.error_message_element.textContent)}render(e){e.appendChild(this.container)}genInputElement(e){var t=createHTMLElement("input");return t.type="text",t.placeholder=e,t.value="",t.style.width="8rem",t}}class SelectDropdownComponent{constructor(t,e,n){this.option_index=1,this.container=createDiv({classes:["line-padding"]});var i=createHTMLElement("button",{classes:["control-button"]});i.textContent="Select "+t,this.dropdown_options_container=createDiv({classes:["dropdown-box"]}),this.dropdown_options_container.style.display="none",this.retrieveLandUseTypes(e,n).then(e=>{e.forEach(e=>{this.addOption(t,e,e)})}),i.onclick=()=>{"none"===this.dropdown_options_container.style.display?this.dropdown_options_container.style.display="block":this.dropdown_options_container.style.display="none"},this.container.appendChild(i),this.container.appendChild(this.dropdown_options_container)}render(e){e.appendChild(this.container)}async retrieveLandUseTypes(e,t){e=e+"/blazegraph/namespace/"+t+"/sparql";try{return(await execSparqlQuery(e,`
    PREFIX opr:<https://www.theworldavatar.com/kg/ontoplanningregulation/>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    SELECT DISTINCT ?landUseType
    WHERE {
      ?regulation a opr:LandUseRegulation;
        opr:appliesTo/rdfs:label ?landUseType.
    }`)).map(e=>e.landUseType.value).sort((e,t)=>e.localeCompare(t))}catch(e){throw console.error("Error executing Sparql query:",e),e}}addOption(e,t,n){var e=e.trim().replace(/\s/g,"").toLowerCase()+this.option_index++,i=createHTMLElement("input"),t=(i.type="checkbox",i.id=e,i.value=t,createHTMLElement("label",{classes:["line-item"]}));t.htmlFor=e,t.appendChild(i),t.appendChild(document.createTextNode(n)),this.dropdown_options_container.appendChild(t)}}class Loader{constructor(){this.id_container="loaderContainer",this.id_loader="loader",this.id_text="loaderText",this.container=createDiv({id:this.id_container}),this.loader=createDiv({id:this.id_loader}),this.loader_text=createDiv({id:this.id_text}),this.loader_text.textContent="LOADING",this.hide()}show(){this.container.style.display="block"}hide(){this.container.style.display="none"}render(e){this.container.appendChild(this.loader),this.container.appendChild(this.loader_text),e.appendChild(this.container)}}class Overlay{constructor(){this.id_overlay="overlay",this.overlay=createDiv({id:this.id_overlay}),this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.height="100vh%",this.overlay.style.width="100vw",this.overlay.style.background="rgba(0, 0, 0, 0.8)",this.overlay.style.zIndex="1000",this.hide()}show(){this.overlay.style.display="block"}hide(){this.overlay.style.display="none"}render(e){e.appendChild(this.overlay)}}