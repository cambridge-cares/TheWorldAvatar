
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A knowledge-graph-based digital twin of the world.">
      
      
      
      
        <link rel="prev" href="../derivation_client/">
      
      
        <link rel="next" href="../logging/">
      
      
      <link rel="icon" href="../../media/twa-logo-blue.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Derivation Agent - The World Avatar</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#twa.agent.derivation_agent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="The World Avatar" class="md-header__button md-logo" aria-label="The World Avatar" data-md-component="logo">
      
  <img src="../../media/twa-logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The World Avatar
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Derivation Agent
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cambridge-cares/TheWorldAvatar/tree/main/JPS_BASE_LIB/python_wrapper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cambridge-cares/TheWorldAvatar
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Get Started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../res_registry/" class="md-tabs__link">
          
  
  API Documentation

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/python_java/" class="md-tabs__link">
          
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The World Avatar" class="md-nav__button md-logo" aria-label="The World Avatar" data-md-component="logo">
      
  <img src="../../media/twa-logo-white.svg" alt="logo">

    </a>
    The World Avatar
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cambridge-cares/TheWorldAvatar/tree/main/JPS_BASE_LIB/python_wrapper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cambridge-cares/TheWorldAvatar
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Get Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Get Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to twa
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wishlist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bug reports/feature requests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Py4j-related
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Py4j-related
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../res_registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../res_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jps_gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JPS Gateway
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Data Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_ontology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BaseOntology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utilities
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    KG Operations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            KG Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sparql_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SparqlClient
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Derived Information Framework
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Derived Information Framework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../derivation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Derivation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../derivation_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Derivation Client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Derivation Agent
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Derivation Agent
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent" class="md-nav__link">
    <span class="md-ellipsis">
      derivation_agent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.FlaskConfig" class="md-nav__link">
    <span class="md-ellipsis">
      FlaskConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent" class="md-nav__link">
    <span class="md-ellipsis">
      DerivationAgent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivationAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.agent_input_concepts" class="md-nav__link">
    <span class="md-ellipsis">
      agent_input_concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.agent_output_concepts" class="md-nav__link">
    <span class="md-ellipsis">
      agent_output_concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.periodical_job" class="md-nav__link">
    <span class="md-ellipsis">
      periodical_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_exception" class="md-nav__link">
    <span class="md-ellipsis">
      send_email_when_exception
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.send_email" class="md-nav__link">
    <span class="md-ellipsis">
      send_email
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_up_to_date" class="md-nav__link">
    <span class="md-ellipsis">
      send_email_when_async_derivation_up_to_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_started" class="md-nav__link">
    <span class="md-ellipsis">
      send_email_when_async_derivation_started
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.get_sparql_client" class="md-nav__link">
    <span class="md-ellipsis">
      get_sparql_client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.register_agent_in_kg" class="md-nav__link">
    <span class="md-ellipsis">
      register_agent_in_kg
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.add_url_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      add_url_pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.monitor_async_derivations" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_async_derivations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.process_request_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      process_request_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.start_all_periodical_job" class="md-nav__link">
    <span class="md-ellipsis">
      start_all_periodical_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.handle_sync_derivations" class="md-nav__link">
    <span class="md-ellipsis">
      handle_sync_derivations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.validate_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.DerivationAgent.run_flask_app" class="md-nav__link">
    <span class="md-ellipsis">
      run_flask_app
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#twa.agent.derivation_agent.format_current_time" class="md-nav__link">
    <span class="md-ellipsis">
      format_current_time
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Logging and Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Logging and Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/python_java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python-Java communications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/additional_java_lib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use additional Java library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/sparql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perform knowledge graph operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/ogm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object Graph Mapper (OGM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/dif/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Derived Information Framework (DIF)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Derivation Agent</h1>

<div class="doc doc-object doc-module">



<a id="twa.agent.derivation_agent"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="twa.agent.derivation_agent.FlaskConfig" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FlaskConfig</span>


<a href="#twa.agent.derivation_agent.FlaskConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#object">object</a></code></p>


        <p>This class provides the configuration for flask app object.
Each config should be provided as constant.
For more information, visit https://flask.palletsprojects.com/en/3.0.x/config/.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.FlaskConfig.SCHEDULER_API_ENABLED">SCHEDULER_API_ENABLED</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enables the Flask Scheduler API (default is True)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="twa.agent.derivation_agent.DerivationAgent" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DerivationAgent</span>


<a href="#twa.agent.derivation_agent.DerivationAgent" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">DerivationAgent</span><span class="p">(</span><span class="n">time_interval</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n">kg_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n">kg_update_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kg_user</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kg_password</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fs_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fs_user</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fs_password</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">derivation_instance_base_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.data_model.iris.TWA_BASE_URL" href="../utilities/#twa.data_model.iris.TWA_BASE_URL">TWA_BASE_URL</a></span><span class="p">,</span> <span class="n">flask_config</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.agent.derivation_agent.FlaskConfig" href="#twa.agent.derivation_agent.FlaskConfig">FlaskConfig</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.agent.derivation_agent.FlaskConfig" href="#twa.agent.derivation_agent.FlaskConfig">FlaskConfig</a></span><span class="p">(),</span> <span class="n">agent_endpoint_base_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;http://localhost:5000/&#39;</span><span class="p">,</span> <span class="n">register_agent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">max_thread_monitor_async_derivations</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">email_recipient</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">email_subject_prefix</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">email_username</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">email_auth_json_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">email_start_end_async_derivations</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">logger_for_dev</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="abc.ABC" href="https://docs.python.org/3/library/abc.html#abc.ABC">ABC</a></code></p>


        <p>Abstract base class for a derivation agent.</p>
<p>This class provides the foundational methods and configurations required for a
derivation agent. It uses a Flask application and APScheduler to manage asynchronous
derivations and periodic jobs.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.app">app</span></code></td>
            <td>
                  <code><span title="flask.Flask">Flask</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Flask application instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.scheduler">scheduler</span></code></td>
            <td>
                  <code><span title="flask_apscheduler.APScheduler">APScheduler</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The APScheduler instance for managing periodic jobs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.time_interval">time_interval</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time interval between two runs of the derivation monitoring job (in seconds).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.max_thread_monitor_async_derivations">max_thread_monitor_async_derivations</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of threads to be used for monitoring async derivations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.syncDerivationEndpoint">syncDerivationEndpoint</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTTP endpoint for handling synchronous derivations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.kgUrl">kgUrl</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SPARQL query endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.kgUpdateUrl">kgUpdateUrl</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SPARQL update endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.kgUser">kgUser</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username for the SPARQL endpoints.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.kgPassword">kgPassword</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Password for the SPARQL endpoints.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.fs_url">fs_url</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File server endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.fs_user">fs_user</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username for the file server.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.fs_password">fs_password</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Password for the file server.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.derivation_client">derivation_client</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.kg_operations.derivation_client.PyDerivationClient" href="../derivation_client/#twa.kg_operations.derivation_client.PyDerivationClient">PyDerivationClient</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Client for managing derivations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.sparql_client">sparql_client</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.kg_operations.PySparqlClient" href="../sparql_client/#twa.kg_operations.sparql_client.PySparqlClient">PySparqlClient</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SPARQL client instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.logger">logger</span></code></td>
            <td>
                  <code>Logger</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logger for the agent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.yag">yag</span></code></td>
            <td>
                  <code><span title="yagmail.SMTP">SMTP</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email client for sending notifications.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.email_recipient">email_recipient</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of email recipients.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.email_subject_prefix">email_subject_prefix</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix for email subjects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.email_start_end_async_derivations">email_start_end_async_derivations</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to send email notifications at the start and end of async derivations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="twa.agent.derivation_agent.DerivationAgent.register_agent">register_agent</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to register the agent to the knowledge graph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_interval</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time interval between two runs of derivation monitoring job (in SECONDS)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kg_url</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SPARQL query endpoint, an example: "http://localhost:8080/blazegraph/namespace/triplestore/sparql"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kg_update_url</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SPARQL update endpoint, will be set to the same value as kg_url if not provided, an example: "http://localhost:8080/blazegraph/namespace/triplestore/sparql"</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kg_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>username used to access the SPARQL query/update endpoint specified by kg_url/kg_update_url</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kg_password</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>password that set for the kg_user used to access the SPARQL query/update endpoint specified by kg_url/kg_update_url</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fs_url</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file server endpoint, an example: "http://localhost:8080/FileServer/"</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fs_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>username used to access the file server endpoint specified by fs_url</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fs_password</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>password that set for the fs_user used to access the file server endpoint specified by fs_url</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>derivation_instance_base_url</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>namespace to be used when creating derivation instance, an example: "http://example.com/kg/"</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.data_model.iris.TWA_BASE_URL" href="../utilities/#twa.data_model.iris.TWA_BASE_URL">TWA_BASE_URL</a></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flask_config</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.agent.derivation_agent.FlaskConfig" href="#twa.agent.derivation_agent.FlaskConfig">FlaskConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>configuration object for flask app, should be an instance of the class FlaskConfig provided as part of this package</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.agent.derivation_agent.FlaskConfig" href="#twa.agent.derivation_agent.FlaskConfig">FlaskConfig</a>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>agent_endpoint_base_url</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>data property OntoAgent:hasHttpUrl of OntoAgent:Operation of the derivation agent, an example: "http://localhost:5000/endpoint"</p>
              </div>
            </td>
            <td>
                  <code>&#39;http://localhost:5000/&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>register_agent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boolean value, whether to register the agent to the knowledge graph</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_thread_monitor_async_derivations</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of threads that to be used for monitoring async derivations</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_recipient</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>recipients of email notification seperated by semicolon, e.g. "abc@email.com;def@email.com"</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_subject_prefix</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>subject prefix of the email title to put in a square bracket, e.g. the email subject will start with "[My Prefix]" when provided "My Prefix"</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_username</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the username to be used as the sender of the email</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_auth_json_path</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file path to the auth json for the <code>email_username</code></p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>email_start_end_async_derivations</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a boolean flag indicating whether to send email notification at the start and end of processing async derivations</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger_for_dev</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>logger for agents in development or production</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>






                  <details class="quote">
                    <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">time_interval</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">kg_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">kg_update_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">kg_user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">kg_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">fs_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">fs_user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">fs_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">derivation_instance_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">TWA_BASE_URL</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">flask_config</span><span class="p">:</span> <span class="n">FlaskConfig</span> <span class="o">=</span> <span class="n">FlaskConfig</span><span class="p">(),</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">agent_endpoint_base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/&quot;</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">register_agent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">max_thread_monitor_async_derivations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">email_recipient</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">email_subject_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">email_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">email_auth_json_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">email_start_end_async_derivations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">logger_for_dev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Initialises the instance of DerivationAgent.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        time_interval (int): time interval between two runs of derivation monitoring job (in SECONDS)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        kg_url (str): SPARQL query endpoint, an example: &quot;http://localhost:8080/blazegraph/namespace/triplestore/sparql&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        kg_update_url (str): SPARQL update endpoint, will be set to the same value as kg_url if not provided, an example: &quot;http://localhost:8080/blazegraph/namespace/triplestore/sparql&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        kg_user (str): username used to access the SPARQL query/update endpoint specified by kg_url/kg_update_url</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        kg_password (str): password that set for the kg_user used to access the SPARQL query/update endpoint specified by kg_url/kg_update_url</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        fs_url (str): file server endpoint, an example: &quot;http://localhost:8080/FileServer/&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        fs_user (str): username used to access the file server endpoint specified by fs_url</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        fs_password (str): password that set for the fs_user used to access the file server endpoint specified by fs_url</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        derivation_instance_base_url (str): namespace to be used when creating derivation instance, an example: &quot;http://example.com/kg/&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        flask_config (FlaskConfig): configuration object for flask app, should be an instance of the class FlaskConfig provided as part of this package</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        agent_endpoint_base_url (str): data property OntoAgent:hasHttpUrl of OntoAgent:Operation of the derivation agent, an example: &quot;http://localhost:5000/endpoint&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        register_agent (bool): boolean value, whether to register the agent to the knowledge graph</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        max_thread_monitor_async_derivations (int): maximum number of threads that to be used for monitoring async derivations</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        email_recipient (str): recipients of email notification seperated by semicolon, e.g. &quot;abc@email.com;def@email.com&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        email_subject_prefix (str): subject prefix of the email title to put in a square bracket, e.g. the email subject will start with &quot;[My Prefix]&quot; when provided &quot;My Prefix&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        email_username (str): the username to be used as the sender of the email</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        email_auth_json_path (str): file path to the auth json for the `email_username`</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        email_start_end_async_derivations (bool): a boolean flag indicating whether to send email notification at the start and end of processing async derivations</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        logger_for_dev (bool): logger for agents in development or production</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># create a JVM module view and use it to import the required java classes</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span> <span class="o">=</span> <span class="n">jpsBaseLibGW</span><span class="o">.</span><span class="n">createModuleView</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">jpsBaseLibGW</span><span class="o">.</span><span class="n">importPackages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="p">,</span> <span class="s2">&quot;uk.ac.cam.cares.jps.base.agent.*&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="n">jpsBaseLibGW</span><span class="o">.</span><span class="n">importPackages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="p">,</span> <span class="s2">&quot;uk.ac.cam.cares.jps.base.query.*&quot;</span><span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">jpsBaseLibGW</span><span class="o">.</span><span class="n">importPackages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="p">,</span> <span class="s2">&quot;uk.ac.cam.cares.jps.base.derivation.*&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1"># initialise flask app with its configuration</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">flask_config</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># initialise flask scheduler and assign time interval for monitor_async_derivations job</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">APScheduler</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="n">time_interval</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">max_thread_monitor_async_derivations</span> <span class="o">=</span> <span class="n">max_thread_monitor_async_derivations</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="c1"># assign IRI and HTTP URL of the agent</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># self.agentIRI</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">syncDerivationEndpoint</span> <span class="o">=</span> <span class="n">agent_endpoint_base_url</span> <span class="o">+</span> <span class="s1">&#39;derivation&#39;</span> <span class="k">if</span> <span class="n">agent_endpoint_base_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">agent_endpoint_base_url</span> <span class="o">+</span> <span class="s1">&#39;/derivation&#39;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="c1"># assign KG related information</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span> <span class="o">=</span> <span class="n">kg_url</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kgUpdateUrl</span> <span class="o">=</span> <span class="n">kg_update_url</span> <span class="k">if</span> <span class="n">kg_update_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kg_url</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="c1"># NOTE that we check first if below are empty string first</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># as the config_derivation_agent will read as &#39;&#39; if the value is not provided in env file</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kgUser</span> <span class="o">=</span> <span class="n">kg_user</span> <span class="k">if</span> <span class="n">kg_user</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kgPassword</span> <span class="o">=</span> <span class="n">kg_password</span> <span class="k">if</span> <span class="n">kg_password</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1"># assign file server related information</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="c1"># NOTE that we check first if below are empty string first</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># as the config_derivation_agent will read as &#39;&#39; if the value is not provided in env file</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fs_url</span> <span class="o">=</span> <span class="n">fs_url</span> <span class="k">if</span> <span class="n">fs_url</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fs_user</span> <span class="o">=</span> <span class="n">fs_user</span> <span class="k">if</span> <span class="n">fs_user</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fs_password</span> <span class="o">=</span> <span class="n">fs_password</span> <span class="k">if</span> <span class="n">fs_password</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="c1"># initialise the derivation_client with SPARQL Query and Update endpoint</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span> <span class="o">=</span> <span class="n">PyDerivationClient</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">derivation_instance_base_url</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kgUpdateUrl</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kgUser</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kgPassword</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="c1"># initialise the SPARQL client as None, this will be replaced when get_sparql_client() is first called</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sparql_client</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="c1"># initialise the logger</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">agentlogging</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span> <span class="k">if</span> <span class="n">logger_for_dev</span> <span class="k">else</span> <span class="s1">&#39;prod&#39;</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="c1"># initialise the email object and email_start_end_async_derivations flag</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">bool</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="n">email_recipient</span><span class="p">,</span> <span class="n">email_username</span><span class="p">,</span> <span class="n">email_auth_json_path</span><span class="p">]]):</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">yag</span> <span class="o">=</span> <span class="n">yagmail</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">email_username</span><span class="p">,</span> <span class="n">oauth2_file</span><span class="o">=</span><span class="n">email_auth_json_path</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">email_recipient</span> <span class="o">=</span> <span class="n">email_recipient</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">email_subject_prefix</span> <span class="o">=</span> <span class="n">email_subject_prefix</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">email_subject_prefix</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">yag</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">email_start_end_async_derivations</span> <span class="o">=</span> <span class="n">email_start_end_async_derivations</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="c1"># register the agent to the KG if required</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">register_agent</span> <span class="o">=</span> <span class="n">register_agent</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">register_agent_in_kg</span><span class="p">()</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="s2">&quot;Failed to register the agent &lt;</span><span class="si">{}</span><span class="s2">&gt; to the KG &lt;</span><span class="si">{}</span><span class="s2">&gt;. Error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">stack_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="s2">&quot;DerivationAgent &lt;</span><span class="si">%s</span><span class="s2">&gt; is initialised to monitor derivations in triple store &lt;</span><span class="si">%s</span><span class="s2">&gt; with a time interval of </span><span class="si">%d</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="twa.agent.derivation_agent.DerivationAgent.agent_input_concepts" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">agent_input_concepts</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#twa.agent.derivation_agent.DerivationAgent.agent_input_concepts" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">agent_input_concepts</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.data_model.base_ontology.BaseClass" href="../base_ontology/#twa.data_model.base_ontology.BaseClass">BaseClass</a></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method returns a list of input concepts of the agent. This should be overridden by the derived class.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="twa.agent.derivation_agent.DerivationAgent.agent_output_concepts" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">agent_output_concepts</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#twa.agent.derivation_agent.DerivationAgent.agent_output_concepts" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">agent_output_concepts</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.data_model.base_ontology.BaseClass" href="../base_ontology/#twa.data_model.base_ontology.BaseClass">BaseClass</a></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method returns a list of output concepts of the agent. This should be overridden by the derived class.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.periodical_job" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">periodical_job</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.periodical_job" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">periodical_job</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method is used to start a periodic job. This should be used as a decorator (@Derivation.periodical_job) for the method that needs to be executed periodically.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="k">def</span> <span class="nf">periodical_job</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This method is used to start a periodic job. This should be used as a decorator (@Derivation.periodical_job) for the method that needs to be executed periodically.&quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Scheduler is started.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">inner</span><span class="o">.</span><span class="n">__is_periodical_job__</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.send_email_when_exception" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">send_email_when_exception</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_exception" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">send_email_when_exception</span><span class="p">(</span><span class="n">func_return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator to send an email when an exception occurs in the decorated method.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="k">def</span> <span class="nf">send_email_when_exception</span><span class="p">(</span><span class="n">func_return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to send an email when an exception occurs in the decorated method.&quot;&quot;&quot;</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">func_return_value</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                        <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email_subject_prefix</span><span class="si">}</span><span class="s2">] exception: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                        <span class="p">[</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                            <span class="n">format_current_time</span><span class="p">(),</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                            <span class="c1"># the &quot;&lt;&quot; and &quot;&gt;&quot; may exist in exception message if any IRI is presented, e.g. &lt;http://iri&gt;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                            <span class="c1"># here we replace them to HTML entities, so that the IRIs can be displayed correctly</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                            <span class="c1"># for more information about HTML entities, visit https://www.w3schools.com/html/html_entities.asp</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="p">),</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                        <span class="p">]</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                    <span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="c1"># Log error regardless</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="k">return</span> <span class="n">inner</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.send_email" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">send_email</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.send_email" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">send_email</span><span class="p">(</span><span class="n">subject</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sends an email notification with the given subject and contents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>subject</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The subject of the email</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>contents</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contents of the email</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    Sends an email notification with the given subject and contents.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        subject (str): The subject of the email</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        contents (list): The contents of the email</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">process_email</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yag</span><span class="o">.</span><span class="n">send</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">email_recipient</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">contents</span><span class="p">))</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">process_email</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="n">process_email</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">if</span> <span class="n">process_email</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">process_email</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">process_email</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">if</span> <span class="n">process_email</span><span class="o">.</span><span class="n">exitcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timed out sending email notification after </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds.</span><span class="se">\n</span><span class="s2"> Recipient: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email_recipient</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Subject: </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Contents: </span><span class="si">{</span><span class="n">contents</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_up_to_date" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">send_email_when_async_derivation_up_to_date</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_up_to_date" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">send_email_when_async_derivation_up_to_date</span><span class="p">(</span><span class="n">derivation_iri</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sends an email notification when an asynchronous derivation is up-to-date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>derivation_iri</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The IRI of the derivation that was processed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="k">def</span> <span class="nf">send_email_when_async_derivation_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">derivation_iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    Sends an email notification when an asynchronous derivation is up-to-date.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        derivation_iri (str): The IRI of the derivation that was processed</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_start_end_async_derivations</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email_subject_prefix</span><span class="si">}</span><span class="s2">] async derivation up-to-date&quot;</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="p">[</span><span class="n">format_current_time</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">derivation_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_started" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">send_email_when_async_derivation_started</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.send_email_when_async_derivation_started" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">send_email_when_async_derivation_started</span><span class="p">(</span><span class="n">derivation_iri</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sends an email notification when an asynchronous derivation starts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>derivation_iri</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The IRI of the derivation that was processed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="k">def</span> <span class="nf">send_email_when_async_derivation_started</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">derivation_iri</span><span class="p">):</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Sends an email notification when an asynchronous derivation starts.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        derivation_iri (str): The IRI of the derivation that was processed</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">email_start_end_async_derivations</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">email_subject_prefix</span><span class="si">}</span><span class="s2">] async derivation now-in-progress&quot;</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="p">[</span><span class="n">format_current_time</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">derivation_iri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.get_sparql_client" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_sparql_client</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.get_sparql_client" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_sparql_client</span><span class="p">(</span><span class="n">sparql_client_cls</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Type" href="https://docs.python.org/3/library/typing.html#typing.Type">Type</a></span><span class="p">[</span><span class="n"><span title="twa.agent.derivation_agent.PY_SPARQL_CLIENT">PY_SPARQL_CLIENT</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="twa.agent.derivation_agent.PY_SPARQL_CLIENT">PY_SPARQL_CLIENT</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a SPARQL client object that instantiated from sparql_client_cls, which should extend PySparqlClient class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sparql_client_cls</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Type" href="https://docs.python.org/3/library/typing.html#typing.Type">Type</a>[<span title="twa.agent.derivation_agent.PY_SPARQL_CLIENT">PY_SPARQL_CLIENT</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SPARQL client class</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PY_SPARQL_CLIENT</code></td>            <td>
                  <code><span title="twa.agent.derivation_agent.PY_SPARQL_CLIENT">PY_SPARQL_CLIENT</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the SPARQL client</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="k">def</span> <span class="nf">get_sparql_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sparql_client_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">PY_SPARQL_CLIENT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PY_SPARQL_CLIENT</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    Returns a SPARQL client object that instantiated from sparql_client_cls, which should extend PySparqlClient class.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        sparql_client_cls (Type[PY_SPARQL_CLIENT]): The SPARQL client class</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        PY_SPARQL_CLIENT: An instance of the SPARQL client</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql_client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparql_client</span><span class="p">,</span> <span class="n">sparql_client_cls</span><span class="p">):</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sparql_client</span> <span class="o">=</span> <span class="n">sparql_client_cls</span><span class="p">(</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">query_endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span> <span class="n">update_endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kgUpdateUrl</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">kg_user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kgUser</span><span class="p">,</span> <span class="n">kg_password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kgPassword</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">fs_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs_url</span><span class="p">,</span> <span class="n">fs_user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs_user</span><span class="p">,</span> <span class="n">fs_pwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fs_password</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparql_client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.register_agent_in_kg" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">register_agent_in_kg</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.register_agent_in_kg" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">register_agent_in_kg</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method registers the agent to the knowledge graph by uploading its OntoAgent triples generated on-the-fly.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="k">def</span> <span class="nf">register_agent_in_kg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This method registers the agent to the knowledge graph by uploading its OntoAgent triples generated on-the-fly.&quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_agent</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">input_concepts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_input_concepts</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">output_concepts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_output_concepts</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_concepts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_concepts</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to proceed with registering the agent &lt;</span><span class="si">{}</span><span class="s2">&gt; to the KG &lt;</span><span class="si">{}</span><span class="s2">&gt;. Error: Input and output concepts must be lists. Received: </span><span class="si">{}</span><span class="s2"> (type: </span><span class="si">{}</span><span class="s2">) and </span><span class="si">{}</span><span class="s2"> (type: </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span> <span class="n">input_concepts</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">input_concepts</span><span class="p">),</span> <span class="n">output_concepts</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">output_concepts</span><span class="p">)))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_concepts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_concepts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to proceed with registering the agent &lt;</span><span class="si">{}</span><span class="s2">&gt; to the KG &lt;</span><span class="si">{}</span><span class="s2">&gt;. Error: No input or output concepts specified.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">))</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">input_concepts_iris</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">o</span><span class="o">.</span><span class="n">rdf_type</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">input_concepts</span><span class="p">]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">output_concepts_iris</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">o</span><span class="o">.</span><span class="n">rdf_type</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">output_concepts</span><span class="p">]</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">createOntoAgentInstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">syncDerivationEndpoint</span><span class="p">,</span> <span class="n">input_concepts_iris</span><span class="p">,</span> <span class="n">output_concepts_iris</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Agent &lt;</span><span class="si">%s</span><span class="s2">&gt; is registered to the KG &lt;</span><span class="si">%s</span><span class="s2">&gt; with input signature </span><span class="si">%s</span><span class="s2"> and output signature </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">,</span> <span class="n">input_concepts</span><span class="p">,</span> <span class="n">output_concepts</span><span class="p">))</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flag register_agent is False. Agent &lt;</span><span class="si">%s</span><span class="s2">&gt; is NOT registered to the KG &lt;</span><span class="si">%s</span><span class="s2">&gt;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kgUrl</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.add_url_pattern" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_url_pattern</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.add_url_pattern" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">add_url_pattern</span><span class="p">(</span><span class="n">url_pattern</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">url_pattern_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">function</span><span class="p">:</span> <span class="n"><span title="flask.typing.RouteCallable">RouteCallable</span></span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">methods</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method is a wrapper of add_url_rule method of Flask object that adds customised URL Pattern to derivation agent.
For more information, visit https://flask.palletsprojects.com/en/3.0.x/api/#flask.Flask.add_url_rule
WARNING: Use of this by developer is STRONGLY discouraged.
The design intention of an derivation agent is to communicate via the KNOWLEDGE GRAPH, and NOT via HTTP requests.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url_pattern</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the endpoint url to associate with the rule and view function</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>url_pattern_name</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the endpoint</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>function</code>
            </td>
            <td>
                  <code><span title="flask.typing.RouteCallable">RouteCallable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the view function to associate with the endpoint</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>methods</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTTP request methods, default to ['GET']</p>
              </div>
            </td>
            <td>
                  <code>[&#39;GET&#39;]</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="k">def</span> <span class="nf">add_url_pattern</span><span class="p">(</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="n">url_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">url_pattern_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">function</span><span class="p">:</span> <span class="n">RouteCallable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">methods</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="p">):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    This method is a wrapper of add_url_rule method of Flask object that adds customised URL Pattern to derivation agent.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    For more information, visit https://flask.palletsprojects.com/en/3.0.x/api/#flask.Flask.add_url_rule</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    WARNING: Use of this by developer is STRONGLY discouraged.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    The design intention of an derivation agent is to communicate via the KNOWLEDGE GRAPH, and NOT via HTTP requests.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        url_pattern (str): the endpoint url to associate with the rule and view function</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        url_pattern_name (str): the name of the endpoint</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        function (flask.typing.RouteCallable): the view function to associate with the endpoint</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        methods (str): HTTP request methods, default to [&#39;GET&#39;]</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url_pattern</span><span class="p">,</span> <span class="n">url_pattern_name</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                          <span class="n">function</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">methods</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A URL Pattern &lt;</span><span class="si">{</span><span class="n">url_pattern</span><span class="si">}</span><span class="s2">&gt; is added.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.monitor_async_derivations" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">monitor_async_derivations</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.monitor_async_derivations" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">monitor_async_derivations</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method monitors the status of the asynchronous derivation that "isDerivedUsing" DerivationAgent.</p>
<p>When it detects the status is "Requested", the agent will mark the status as "InProgress" and start the job.
Once the job is finished, the agent marks the status as "Finished" and attaches the new derived IRI to it via "hasNewDerivedIRI".
All new generated triples are also written to the knowledge graph at this point.</p>
<p>When it detects the status is "InProgress", the currently implementation just passes.</p>
<p>When it detects the status is "Finished", the agent deletes the old entities,
reconnects the new instances (previously attached to the status via "hasNewDerivedIRI") with the original derivation,
cleans up all the status, and finally updates the timestamp of the derivation.
All these processing steps at the <code>Finished</code> status are taken care of by method
<code>uk.ac.cam.cares.jps.base.derivation.DerivationClient.cleanUpFinishedDerivationUpdate(String)</code>.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="nd">@send_email_when_exception</span><span class="p">(</span><span class="n">func_return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="k">def</span> <span class="nf">monitor_async_derivations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    This method monitors the status of the asynchronous derivation that &quot;isDerivedUsing&quot; DerivationAgent.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    When it detects the status is &quot;Requested&quot;, the agent will mark the status as &quot;InProgress&quot; and start the job.</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    Once the job is finished, the agent marks the status as &quot;Finished&quot; and attaches the new derived IRI to it via &quot;hasNewDerivedIRI&quot;.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    All new generated triples are also written to the knowledge graph at this point.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    When it detects the status is &quot;InProgress&quot;, the currently implementation just passes.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    When it detects the status is &quot;Finished&quot;, the agent deletes the old entities,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    reconnects the new instances (previously attached to the status via &quot;hasNewDerivedIRI&quot;) with the original derivation,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    cleans up all the status, and finally updates the timestamp of the derivation.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    All these processing steps at the `Finished` status are taken care of by method</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    `uk.ac.cam.cares.jps.base.derivation.DerivationClient.cleanUpFinishedDerivationUpdate(String)`.</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="c1"># Below codes follow the logic as defined in DerivationAgent.java in JPS_BASE_LIB</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># for more information, please visit https://github.com/cambridge-cares/TheWorldAvatar/blob/main/JPS_BASE_LIB/src/main/java/uk/ac/cam/cares/jps/base/agent/DerivationAgent.java</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="c1"># Initialise two conditions for the while loop</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="c1"># 1. break_out_time is the timestamp when the next round of monitoring should be started</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="n">break_out_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_interval</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="c1"># 2. query_again is the flag to indicate whether the derivation status should be updated in memory</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="c1"># There is no do-while loop in Python, so we use a while loop with a break statement</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="c1"># &quot;while True&quot; makes sure the loop is executed at least once</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="c1"># Retrieves a list of derivations and their status type that &quot;isDerivedUsing&quot; DerivationAgent</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">derivationAndStatusType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">getDerivationsAndStatusType</span><span class="p">(</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">derivationAndStatusType</span><span class="p">):</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;A list of asynchronous derivations that &lt;isDerivedUsing&gt; &lt;</span><span class="si">%s</span><span class="s2">&gt; are retrieved: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="p">{</span><span class="n">d</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">derivationAndStatusType</span><span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">derivationAndStatusType</span><span class="p">}))</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="c1"># Iterate over the list of derivation, and do different things depend on the derivation status</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="k">for</span> <span class="n">derivation</span> <span class="ow">in</span> <span class="n">derivationAndStatusType</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="n">statusType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">derivationAndStatusType</span><span class="p">[</span><span class="n">derivation</span><span class="p">])</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                    <span class="c1"># If &quot;Requested&quot;, check the immediate upstream derivations if they are up-to-date</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                    <span class="c1"># if any of the asynchronous derivations are still outdated, skip, otherwise, request update of all synchronous derivations</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                    <span class="c1"># then retrieve inputs, marks as &quot;InProgress&quot;, start job, update status at job completion</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                    <span class="k">if</span> <span class="n">statusType</span> <span class="o">==</span> <span class="s1">&#39;REQUESTED&#39;</span><span class="p">:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                        <span class="n">immediateUpstreamDerivationToUpdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">checkImmediateUpstreamDerivation</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationSparql</span><span class="o">.</span><span class="n">ONTODERIVATION_DERIVATIONASYN</span> <span class="ow">in</span> <span class="n">immediateUpstreamDerivationToUpdate</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;&quot;</span> <span class="o">+</span> <span class="n">derivation</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                                            <span class="o">+</span> <span class="s2">&quot;&gt; has a list of immediate upstream asynchronous derivations to be updated: &quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">immediateUpstreamDerivationToUpdate</span><span class="p">))</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                            <span class="c1"># set flag to false to skips this &quot;Requested&quot; derivation until next time</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                            <span class="c1"># this is to avoid the agent flooding the KG with queries of the status over a short period of time</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                            <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                            <span class="n">syncDerivationsToUpdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">groupSyncDerivationsToUpdate</span><span class="p">(</span><span class="n">immediateUpstreamDerivationToUpdate</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">syncDerivationsToUpdate</span><span class="p">):</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;&quot;</span> <span class="o">+</span> <span class="n">derivation</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                                                <span class="o">+</span> <span class="s2">&quot;&gt; has a list of immediate upstream synchronous derivations to be updated: &quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                                                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">syncDerivationsToUpdate</span><span class="p">))</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">updatePureSyncDerivations</span><span class="p">(</span><span class="n">syncDerivationsToUpdate</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Update of synchronous derivation is done for: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">syncDerivationsToUpdate</span><span class="p">))</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">checkImmediateUpstreamDerivation</span><span class="p">(</span><span class="n">derivation</span><span class="p">)):</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                                <span class="n">agentInputs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">retrieveAgentInputIRIs</span><span class="p">(</span><span class="n">derivation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">))</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                                <span class="c1"># Mark the status as &quot;InProgress&quot;</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                                <span class="c1"># if another agent thread is updating the same derivation concurrently</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                                <span class="c1"># and successed before this thread, then this method will return false</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                                <span class="n">progressToJob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">updateStatusBeforeSetupJob</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                                <span class="c1"># only progress to job if the status is updated successfully</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                                <span class="c1"># otherwise, the other thread will handle the job</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">progressToJob</span><span class="p">:</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asynchronous derivation &lt;</span><span class="si">{</span><span class="n">derivation</span><span class="si">}</span><span class="s2">&gt; is already in progress by another agent thread.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Agent &lt;</span><span class="si">%s</span><span class="s2">&gt; retrieved inputs of asynchronous derivation &lt;</span><span class="si">%s</span><span class="s2">&gt;: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">,</span> <span class="n">derivation</span><span class="p">,</span> <span class="n">agentInputs</span><span class="p">))</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;</span><span class="si">%s</span><span class="s2">&gt; is in progress.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">derivation</span><span class="p">))</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                                    <span class="c1"># send email to indicate the derivation is handled in this thread and started, i.e. now-in-progress</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">send_email_when_async_derivation_started</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                                    <span class="c1"># Preprocessing inputs to be sent to agent for setting up job, this is now in dict datatype</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                                    <span class="n">agent_input_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">agentInputs</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agentInputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">agentInputs</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                                    <span class="n">agent_input_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_INPUT_KEY</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                                    <span class="k">if</span> <span class="n">agent_input_key</span> <span class="ow">in</span> <span class="n">agent_input_json</span><span class="p">:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                                        <span class="n">inputs_to_send</span> <span class="o">=</span> <span class="n">agent_input_json</span><span class="p">[</span><span class="n">agent_input_key</span><span class="p">]</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Agent input key (</span><span class="si">%s</span><span class="s2">) might be missing. Received input: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                                            <span class="n">agent_input_key</span><span class="p">,</span> <span class="n">agent_input_json</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">))</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                                    <span class="c1"># The inputs_to_send should be a key-values pair format,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                                    <span class="c1"># for example: {&#39;OntoXX:Concept_A&#39;: [&#39;Instance_A&#39;], &#39;OntoXX:Concept_B&#39;: [&#39;Instance_B&#39;]}</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                                    <span class="n">derivationInputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationInputs</span><span class="p">(</span><span class="n">inputs_to_send</span><span class="p">,</span> <span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                                    <span class="n">derivation_inputs</span> <span class="o">=</span> <span class="n">DerivationInputs</span><span class="p">(</span><span class="n">derivationInputs</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                                    <span class="n">derivationOutputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="p">()</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                                    <span class="n">derivation_outputs</span> <span class="o">=</span> <span class="n">DerivationOutputs</span><span class="p">(</span><span class="n">derivationOutputs</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">process_request_parameters</span><span class="p">(</span><span class="n">derivation_inputs</span><span class="p">,</span> <span class="n">derivation_outputs</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                                    <span class="n">newDerivedIRI</span> <span class="o">=</span> <span class="n">derivationOutputs</span><span class="o">.</span><span class="n">getNewDerivedIRI</span><span class="p">()</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                                    <span class="n">newTriples</span> <span class="o">=</span> <span class="n">derivationOutputs</span><span class="o">.</span><span class="n">getOutputTriples</span><span class="p">()</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">updateStatusAtJobCompletion</span><span class="p">(</span><span class="n">derivation</span><span class="p">,</span> <span class="n">newDerivedIRI</span><span class="p">,</span> <span class="n">newTriples</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;</span><span class="si">%s</span><span class="s2">&gt; generated new derived IRI: &lt;</span><span class="si">%s</span><span class="s2">&gt;.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                                        <span class="n">derivation</span><span class="p">,</span> <span class="s2">&quot;&gt;, &lt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newDerivedIRI</span><span class="p">)))</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;&quot;</span> <span class="o">+</span> <span class="n">derivation</span> <span class="o">+</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                                                    <span class="s2">&quot;&gt; has all new generated triples: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">getQueryString</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">newTriples</span><span class="p">]))</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;&quot;</span> <span class="o">+</span> <span class="n">derivation</span> <span class="o">+</span> <span class="s2">&quot;&gt; is now finished, to be cleaned up.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                            <span class="c1"># set flag to true as either (1) the agent has been process this derivation for some time</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                            <span class="c1"># and status of other derivations in KG might have changed by other processes during this time</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                            <span class="c1"># or (2) the derivation is processed by another agent therefore needs a record update</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                            <span class="n">query_again</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="c1"># If &quot;InProgress&quot;, pass</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                    <span class="k">elif</span> <span class="n">statusType</span> <span class="o">==</span> <span class="s1">&#39;INPROGRESS&#39;</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                        <span class="c1"># the query_again flag is set as false to let agent carry on to next derivation in the list</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                        <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                    <span class="c1"># If &quot;Finished&quot;, do all the clean-up steps</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                    <span class="k">elif</span> <span class="n">statusType</span> <span class="o">==</span> <span class="s1">&#39;FINISHED&#39;</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">cleanUpFinishedDerivationUpdate</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>                        <span class="c1"># set flag to true as the cleaning up process can take some time when there are a lot of triples</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>                        <span class="n">query_again</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                        <span class="c1"># send email to indicate the derivation is now finished and cleaned up, i.e. up-to-date</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">send_email_when_async_derivation_up_to_date</span><span class="p">(</span><span class="n">derivation</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                    <span class="k">elif</span> <span class="n">statusType</span> <span class="o">==</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                        <span class="c1"># for now just passes</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>                        <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                    <span class="k">elif</span> <span class="n">statusType</span> <span class="o">==</span> <span class="s1">&#39;NOSTATUS&#39;</span><span class="p">:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                        <span class="c1"># no need to query_again as the derivation is considered as up-to-date</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                        <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                    <span class="c1"># If anything else, pass</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Asynchronous derivation &lt;</span><span class="si">%s</span><span class="s2">&gt; has unhandled status type: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                            <span class="n">derivation</span><span class="p">,</span> <span class="n">statusType</span><span class="p">))</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                        <span class="n">query_again</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                    <span class="n">trace_back</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                    <span class="n">jps_exc</span> <span class="o">=</span> <span class="n">PythonException</span><span class="p">(</span><span class="n">trace_back</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">markAsError</span><span class="p">(</span><span class="n">derivation</span><span class="p">,</span> <span class="n">jps_exc</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                    <span class="n">query_again</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error when handling derivation &lt;</span><span class="si">{</span><span class="n">derivation</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                    <span class="c1"># Raise exception so that this will be sent via email notification</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                    <span class="k">raise</span> <span class="n">exc</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="c1"># Break out the for loop and query again the list of derivations and their status</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="k">if</span> <span class="n">query_again</span><span class="p">:</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                    <span class="k">break</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Currently, no asynchronous derivation &lt;isDerivedUsing&gt; &lt;</span><span class="si">%s</span><span class="s2">&gt;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="p">))</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="c1"># Check if the two flags are still met, if not, break out the while loop</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="c1"># i.e. process until the time is up and if have not gone through all derivations</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">break_out_time</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">query_again</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.process_request_parameters" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">process_request_parameters</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#twa.agent.derivation_agent.DerivationAgent.process_request_parameters" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">process_request_parameters</span><span class="p">(</span><span class="n">derivation_inputs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.data_model.derivation.DerivationInputs" href="../derivation/#twa.data_model.derivation.DerivationInputs">DerivationInputs</a></span><span class="p">,</span> <span class="n">derivation_outputs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="twa.data_model.derivation.DerivationOutputs" href="../derivation/#twa.data_model.derivation.DerivationOutputs">DerivationOutputs</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method perform the agent logic of converting derivation inputs to derivation outputs.
Developer shall override this when writing new derivation agent based on DerivationAgent class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>derivation_inputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.data_model.derivation.DerivationInputs" href="../derivation/#twa.data_model.derivation.DerivationInputs">DerivationInputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>instance of derivation inputs, essentially in the format of:
{
    "https://example.com/kg/Concept_1": ["https://example.com/kg/Concept_1/Instance_1"],
    "https://example.com/kg/Concept_2": ["https://example.com/kg/Concept_2/Instance_2"],
    "https://example.com/kg/Concept_3":
    ["https://example.com/kg/Concept_3/Instance_3_1",
        "https://example.com/kg/Concept_3/Instance_3_2"],
    "https://example.com/kg/Concept_4": ["https://example.com/kg/Concept_4/Instance_4"]
}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>derivation_outputs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="twa.data_model.derivation.DerivationOutputs" href="../derivation/#twa.data_model.derivation.DerivationOutputs">DerivationOutputs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>instance of derivation outputs, developer should add new created entiteis and triples to this variable</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="nd">@abstractmethod</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span> <span class="nf">process_request_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">derivation_inputs</span><span class="p">:</span> <span class="n">DerivationInputs</span><span class="p">,</span> <span class="n">derivation_outputs</span><span class="p">:</span> <span class="n">DerivationOutputs</span><span class="p">):</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">    This method perform the agent logic of converting derivation inputs to derivation outputs.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    Developer shall override this when writing new derivation agent based on DerivationAgent class.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        derivation_inputs (DerivationInputs): instance of derivation inputs, essentially in the format of:</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">            {</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">                &quot;https://example.com/kg/Concept_1&quot;: [&quot;https://example.com/kg/Concept_1/Instance_1&quot;],</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">                &quot;https://example.com/kg/Concept_2&quot;: [&quot;https://example.com/kg/Concept_2/Instance_2&quot;],</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">                &quot;https://example.com/kg/Concept_3&quot;:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">                [&quot;https://example.com/kg/Concept_3/Instance_3_1&quot;,</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">                    &quot;https://example.com/kg/Concept_3/Instance_3_2&quot;],</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">                &quot;https://example.com/kg/Concept_4&quot;: [&quot;https://example.com/kg/Concept_4/Instance_4&quot;]</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">            }</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        derivation_outputs (DerivationOutputs): instance of derivation outputs, developer should add new created entiteis and triples to this variable</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.start_all_periodical_job" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">start_all_periodical_job</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.start_all_periodical_job" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">start_all_periodical_job</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method starts all scheduled periodical jobs.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="k">def</span> <span class="nf">start_all_periodical_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This method starts all scheduled periodical jobs.&quot;&quot;&quot;</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="n">all_periodical_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="s1">&#39;__is_periodical_job__&#39;</span><span class="p">)]</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">all_periodical_jobs</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="n">func</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.handle_sync_derivations" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">handle_sync_derivations</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.handle_sync_derivations" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">handle_sync_derivations</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method handles synchronous derivation by using the Flask app object of the DerivationAgent to process the HTTP request,
and then pass it to <code>process_request_parameters</code> function provided by the developers.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="nd">@send_email_when_exception</span><span class="p">(</span><span class="n">func_return_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="k">def</span> <span class="nf">handle_sync_derivations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    This method handles synchronous derivation by using the Flask app object of the DerivationAgent to process the HTTP request,</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    and then pass it to `process_request_parameters` function provided by the developers.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received synchronous derivation request: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="n">requestParams</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">(</span><span class="n">requestParams</span><span class="p">):</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="c1"># retrieve necessary information</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">derivationIRI</span> <span class="o">=</span> <span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">DERIVATION_KEY</span><span class="p">]</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="n">derivationType</span> <span class="o">=</span> <span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">DERIVATION_TYPE_KEY</span><span class="p">]</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">syncNewInfoFlag</span> <span class="o">=</span> <span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">SYNC_NEW_INFO_FLAG</span><span class="p">]</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="c1"># serialises DerivationInputs objects from JSONObject</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationInputs</span><span class="p">(</span><span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_INPUT_KEY</span><span class="p">],</span> <span class="n">derivationIRI</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received derivation request parameters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">requestParams</span><span class="p">))</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="c1"># initialise DerivationOutputs, also set up information</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="p">()</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="n">outputs</span><span class="o">.</span><span class="n">setThisDerivation</span><span class="p">(</span><span class="n">derivationIRI</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="n">outputs</span><span class="o">.</span><span class="n">setRetrievedInputsAt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">syncNewInfoFlag</span><span class="p">:</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">setOldEntitiesMap</span><span class="p">(</span><span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">BELONGSTO_KEY</span><span class="p">])</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">setOldEntitiesDownstreamDerivationMap</span><span class="p">(</span><span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">DOWNSTREAMDERIVATION_KEY</span><span class="p">])</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="c1"># apply agent logic to convert inputs to outputs</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="n">derivation_inputs</span> <span class="o">=</span> <span class="n">DerivationInputs</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">derivation_outputs</span> <span class="o">=</span> <span class="n">DerivationOutputs</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">process_request_parameters</span><span class="p">(</span><span class="n">derivation_inputs</span><span class="p">,</span> <span class="n">derivation_outputs</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="c1"># return response if this sync derivation is generated for new info</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="k">if</span> <span class="n">syncNewInfoFlag</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">agentServiceIRI</span> <span class="o">=</span> <span class="n">requestParams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_IRI_KEY</span><span class="p">]</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">writeSyncDerivationNewInfo</span><span class="p">(</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                <span class="n">outputs</span><span class="o">.</span><span class="n">getOutputTriples</span><span class="p">(),</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getNewDerivedIRI</span><span class="p">(),</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="n">agentServiceIRI</span><span class="p">,</span> <span class="n">inputs</span><span class="o">.</span><span class="n">getAllIris</span><span class="p">(),</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="n">derivationIRI</span><span class="p">,</span> <span class="n">derivationType</span><span class="p">,</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getRetrievedInputsAt</span><span class="p">()</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="p">)</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="o">.</span><span class="n">RETRIEVED_INPUTS_TIMESTAMP_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getRetrievedInputsAt</span><span class="p">()</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">getNewEntitiesJsonMap</span><span class="p">()))</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Synchronous derivation for new information generated successfully, returned response: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="c1"># only enters below if the computation was not for new information (new instances)</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">derivation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">Derivation</span><span class="p">(</span><span class="n">derivationIRI</span><span class="p">,</span> <span class="n">derivationType</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">derivation</span><span class="o">.</span><span class="n">isDerivationAsyn</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">derivation</span><span class="o">.</span><span class="n">isDerivationWithTimeSeries</span><span class="p">():</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="c1"># Perform the mapping between the new outputs and the downstream derivations</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">connectionMap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">mapSyncNewOutputsToDownstream</span><span class="p">(</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="n">outputs</span><span class="o">.</span><span class="n">getThisDerivation</span><span class="p">(),</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getNewOutputsAndRdfTypeMap</span><span class="p">())</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="c1"># construct and fire SPARQL update given DerivationOutputs objects, if normal</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>            <span class="c1"># derivation NOTE this makes sure that the new generated instances/triples will</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="c1"># ONLY be written to knowledge graph if the target derivation is till outdated</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="c1"># at the point of executing SPARQL update, i.e. this solves concurrent request</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="c1"># issue as detailed in</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="c1"># https://github.com/cambridge-cares/TheWorldAvatar/issues/184</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">triplesChangedForSure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">reconnectSyncDerivation</span><span class="p">(</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="n">outputs</span><span class="o">.</span><span class="n">getThisDerivation</span><span class="p">(),</span> <span class="n">connectionMap</span><span class="p">,</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="n">outputs</span><span class="o">.</span><span class="n">getOutputTriples</span><span class="p">(),</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getRetrievedInputsAt</span><span class="p">()</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="c1"># for normal Derivation, we need to return both timestamp and the new derived</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="k">if</span> <span class="n">triplesChangedForSure</span><span class="p">:</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="c1"># if we know the triples are changed for sure, we return the triples</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>                <span class="c1"># computed by this agent</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="o">.</span><span class="n">RETRIEVED_INPUTS_TIMESTAMP_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getRetrievedInputsAt</span><span class="p">()</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">getNewEntitiesJsonMap</span><span class="p">()))</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_CONNECTION_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">JSONObject</span><span class="p">(</span><span class="n">connectionMap</span><span class="p">)))</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Derivation update is done in the knowledge graph, returned response: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="c1"># if we are not certain, query the knowledge graph to get the accurate</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="c1"># information</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">derivation_client</span><span class="o">.</span><span class="n">getDerivation</span><span class="p">(</span><span class="n">derivationIRI</span><span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="o">.</span><span class="n">RETRIEVED_INPUTS_TIMESTAMP_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span><span class="o">.</span><span class="n">getTimestamp</span><span class="p">()</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">getBelongsToMap</span><span class="p">()))</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_CONNECTION_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">getDownstreamDerivationConnectionMap</span><span class="p">()))</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to determine if the SPARQL update mutated triples, returned latest information in knowledge graph: &quot;</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                                 <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="c1"># for DerivationWithTimeSeries, we just need to return retrievedInputsAt</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationOutputs</span><span class="o">.</span><span class="n">RETRIEVED_INPUTS_TIMESTAMP_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getRetrievedInputsAt</span><span class="p">()</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>                <span class="s2">&quot;DerivationWithTimeSeries update is done, returned response: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="n">res</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_OUTPUT_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationAgent</span><span class="o">.</span><span class="n">EMPTY_REQUEST_MSG</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.validate_inputs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_inputs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#twa.agent.derivation_agent.DerivationAgent.validate_inputs" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate_inputs</span><span class="p">(</span><span class="n">http_request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validates the HTTP request sent to the agent for processing synchronous derivations.
Developer can overwrite this function for customised validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>http_request</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The HTTP request received</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HTTP request is empty</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IRI for derivation is not provided in the HTTP request</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IRI for agent is not provided in the HTTP request</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IRI for old derivation outputs are not provided in the HTTP request</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IRI for downstream derivations are not provided in the HTTP request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the HTTP request is valid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="nd">@abstractmethod</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    Validates the HTTP request sent to the agent for processing synchronous derivations.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    Developer can overwrite this function for customised validation.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        http_request: The HTTP request received</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        Exception: HTTP request is empty</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        Exception: IRI for derivation is not provided in the HTTP request</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">        Exception: IRI for agent is not provided in the HTTP request</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        Exception: IRI for old derivation outputs are not provided in the HTTP request</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        Exception: IRI for downstream derivations are not provided in the HTTP request</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">        bool: Whether the HTTP request is valid</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating inputs: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">http_request</span><span class="p">))</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">http_request</span><span class="p">):</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;RequestParams are empty, throwing BadRequestException...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;RequestParams are empty&quot;</span><span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_INPUT_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">http_request</span><span class="p">:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="si">}</span><span class="s2">&gt; received an empty request...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">DERIVATION_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">http_request</span><span class="p">:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Agent &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="si">}</span><span class="s2">&gt; received a request that doesn&#39;t have derivationIRI...&quot;</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="k">if</span> <span class="n">http_request</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">SYNC_NEW_INFO_FLAG</span><span class="p">]:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">AGENT_IRI_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">http_request</span><span class="p">:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Agent &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="si">}</span><span class="s2">&gt; received a request for sync new information that doesn&#39;t have information about agent IRI...&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">BELONGSTO_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">http_request</span><span class="p">:</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Agent &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="si">}</span><span class="s2">&gt; received a request that doesn&#39;t have information about old outputs...&quot;</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jpsBaseLib_view</span><span class="o">.</span><span class="n">DerivationClient</span><span class="o">.</span><span class="n">DOWNSTREAMDERIVATION_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">http_request</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Agent &lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agentIRI</span><span class="si">}</span><span class="s2">&gt; received a request that doesn&#39;t have information about downstream derivation...&quot;</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="twa.agent.derivation_agent.DerivationAgent.run_flask_app" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_flask_app</span>


<a href="#twa.agent.derivation_agent.DerivationAgent.run_flask_app" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_flask_app</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This method runs the flask app as an HTTP servlet.</p>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="k">def</span> <span class="nf">run_flask_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This method runs the flask app as an HTTP servlet.&quot;&quot;&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="twa.agent.derivation_agent.format_current_time" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">format_current_time</span>


<a href="#twa.agent.derivation_agent.format_current_time" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">format_current_time</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Formats the current local time as a string.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current local time in the format "YYYY-MM-DD HH:MM:SS TIMEZONE".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>JPS_BASE_LIB/python_wrapper/twa/agent/derivation_agent.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="k">def</span> <span class="nf">format_current_time</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    Formats the current local time as a string.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        str: The current local time in the format &quot;YYYY-MM-DD HH:MM:SS TIMEZONE&quot;.</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()))</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span><span class="o">.</span><span class="n">tm_zone</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>